(version 1)

;; 1. Allow everything by default (network, process, read, etc.)
(allow default)

;; 2. Set the default policy for WRITES to DENY.
(deny file-write*)

;; 3. Whitelist specific WRITE paths
(allow file-write*
    ;; Project
    (subpath "/Users/bryantinsley/Code/machinator")
    
    ;; Configuration & State
    (subpath "/Users/bryantinsley/.gemini")
    (subpath "/Users/bryantinsley/.config")
    (subpath "/Users/bryantinsley/.cache")
    (subpath "/Users/bryantinsley/Library/Caches")
    (subpath "/Users/bryantinsley/Library/Logs")

    ;; System Temp
    (subpath "/tmp")
    (subpath "/private/tmp")
    (subpath "/var/tmp")
    (subpath "/private/var/tmp")
    (subpath "/var/folders")
    (subpath "/private/var/folders")
    
    ;; All devices - ttyd needs PTY access
    (subpath "/dev")
)

;; 4. Explicitly allow READ everywhere
(allow file-read*
    (subpath "/")
)

;; 5. Allow all file operations on devices (needed for ttyd PTY)
(allow file-ioctl
    (subpath "/dev")
)

;; 6. Allow pseudo-terminal operations
(allow pseudo-tty)

;; 7. Allow process operations (ttyd spawns shells)
(allow process-fork)
(allow process-exec)

;; 8. Allow network operations (ttyd serves on localhost)
(allow network*)

;; 9. Allow mach operations (IPC, needed for some terminal ops)
(allow mach*)

;; 10. Allow sysctl reads (system info)
(allow sysctl-read)
